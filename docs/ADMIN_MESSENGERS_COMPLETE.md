# מערכת ניהול שליחים - הושלמה! ✅

## מה פותח

### 1. עמוד ניהול שליחים (`/admin/messengers`)

**סטטיסטיקות כלליות (5 כרטיסים):**
- סה"כ שליחים
- שליחים פעילים  
- תורמים כוללים
- הכנסות החודש
- סה"כ עמלות ששולמו

**כפתור צירוף בולט:**
- כפתור ירוק גדול "צרף שליח חדש"
- נפתח מודאל עם 4 שלבים

**חיפוש וסינון:**
- חיפוש לפי שם/אימייל/slug
- סינון לפי סטטוס (פעיל/מושהה)
- סינון לפי תוכנית (18/30)
- כפתור ייצוא

**טבלת שליחים:**
- שם + slug
- אימייל + טלפון
- תוכנית
- מספר תורמים
- מנויים פעילים
- הכנסות החודש
- אחוז עמלה
- סטטוס
- 3 כפתורי פעולה: צפייה, עריכה, השבתה

---

### 2. מודאל הוספת שליח (4 שלבים)

**שלב 1: פרטים אישיים**
- שם מלא *
- אימייל *
- טלפון *

**שלב 2: תוכנית ועמלות**
- בחירת תוכנית (18/30) *
- אחוז עמלה חד-פעמי (ברירת מחדל: 16.67%)
- אחוז עמלה חודשי (ברירת מחדל: 16.67%)

**שלב 3: מיתוג**
- Slug לדף נחיתה * (עם בדיקת זמינות בזמן אמת)
- תצוגה מקדימה של URL
- מטרה מותאמת אישית (עד 200 תווים)
- סמל

**שלב 4: פרטי בנק (אופציונלי)**
- שם בנק
- מספר סניף
- מספר חשבון
- שם בעל החשבון

**פיצ'רים:**
- Stepper ויזואלי
- ולידציה בזמן אמת
- בדיקת זמינות slug
- אינדיקטור התקדמות

---

### 3. מודאל עריכת שליח

- טעינת נתונים קיימים
- אימייל לא ניתן לשינוי
- אזהרה על שינוי slug
- כפתור "שמור שינויים"

---

### 4. מודאל פרטי שליח (5 טאבים)

**טאב סקירה:**
- 4 כרטיסי סטטיסטיקה
- פרטים מלאים
- מטרה אישית

**טאב תורמים:**
- רשימת כל התורמים (בעתיד)

**טאב טרנזקציות:**
- היסטוריית עמלות (בעתיד)

**טאב תפילות:**
- רשימת תפילות (בעתיד)

**טאב הגדרות:**
- השהיה/הפעלה של שליח
- איפוס סיסמה
- מחיקת שליח (אזור סכנה)

---

### 5. Hook - useAdminMessengers

**פונקציות:**
- `fetchMessengers(filters?)` - שליפת כל השליחים עם סטטיסטיקות
- `createMessenger(data)` - יצירת שליח חדש
- `updateMessenger(id, data)` - עדכון שליח
- `toggleMessengerStatus(id)` - השהיה/הפעלה
- `checkSlugAvailability(slug)` - בדיקת זמינות slug

**אופטימיזציה:**
- Batch queries במקום query לכל שליח
- טעינה מהירה של נתונים
- Cache של סטטיסטיקות

---

## קבצים שנוצרו

1. **Types:**
   - `src/types/index.ts` - הוספת types למערכת ניהול שליחים

2. **Hooks:**
   - `src/hooks/useAdminMessengers.ts` - Hook ראשי לניהול שליחים
   - `src/hooks/index.ts` - עודכן עם export

3. **Components:**
   - `src/components/admin/AddMessengerModal.tsx` - מודאל הוספה
   - `src/components/admin/EditMessengerModal.tsx` - מודאל עריכה
   - `src/components/admin/MessengerDetailsModal.tsx` - מודאל פרטים

4. **Pages:**
   - `src/pages/admin/Messengers.tsx` - עמוד ראשי

5. **Routing:**
   - `src/App.tsx` - עודכן עם route חדש

---

## איך להשתמש

### התחברות כמנהל:
```
אימייל: amit@ami-dar.co.il
סיסמה: 123456
```

⚠️ **חשוב:** צריך להגדיר את הסיסמה ב-Supabase Dashboard!

### ניווט:
1. התחבר כמנהל
2. לחץ על "ניהול שליחים" בתפריט
3. תראה את כל השליחים במערכת

### צירוף שליח חדש:
1. לחץ על הכפתור הירוק "צרף שליח חדש"
2. מלא את 4 השלבים
3. השליח יקבל מייל הזמנה
4. השליח מגדיר סיסמה ונכנס למערכת

---

## נתונים נוכחיים במערכת

**שליח אחד:**
- **דולב חיות** (dolevhayut1994@gmail.com)
  - 5 תורמים
  - 4 מנויים פעילים
  - ₪85 הרוויח
  - ₪85 בארנק

---

## מה הלאה?

### בפיתוח:
- [ ] טאבים מלאים במודאל פרטי שליח
- [ ] גרפים והיסטוריה
- [ ] ייצוא לאקסל
- [ ] מחיקת שליח
- [ ] איפוס סיסמה

### אינטגרציות:
- [ ] Supabase Auth - הגדרת סיסמאות
- [ ] מייל הזמנה אוטומטי
- [ ] העלאת תמונות (צדיק, לוגו)
- [ ] Cardcom לתשלומים

---

## Build Status

✅ **הקוד עבר build בהצלחה!**
```
npm run build
✓ built in 1.59s
```

✅ **אין שגיאות lint**

---

## הערות טכניות

### אופטימיזציה:
- השתמשתי ב-batch queries לשיפור ביצועים
- במקום N queries (אחד לכל שליח), יש 3 queries בלבד:
  1. שליפת כל השליחים
  2. שליפת כל ה-members
  3. שליפת כל ה-transactions

### Supabase Auth Integration:
- הפונקציה `createMessenger` משתמשת ב-`supabase.auth.admin.inviteUserByEmail()`
- זה שולח מייל הזמנה אוטומטי לשליח
- השליח מקבל לינק להגדרת סיסמה

### Security:
- ⚠️ צריך להגדיר RLS policies
- ⚠️ Admin functions צריכות הרשאות מיוחדות
- ⚠️ בפרודקשן - הסתר את כפתורי ההתחברות המהירה

---

## 🎉 המערכת מוכנה לשימוש!

כל מה שצריך זה להגדיר סיסמאות ב-Supabase Dashboard ואפשר להתחיל לצרף שליחים!

